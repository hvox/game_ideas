#!/usr/bin/env python3
import clipboard
from factorio.blueprints import decode, encode


def print_json_representation(code: str):
    import base64
    import json
    import zlib

    compressed = base64.b64decode(original_code[1:])
    decoded = json.loads(zlib.decompress(compressed).decode())
    print(decoded)


original_code = clipboard.paste()
print_json_representation(original_code)
blueprint = decode(original_code)
for (x, y), (name, attrs) in blueprint.items():
    print(f"{x:6} {y:6} {name:20} {attrs}")
new_code = encode(blueprint)
print(f"old code: {len(original_code)} characters")
print(f"new code: {len(new_code)} characters")
new_bluprint = decode(new_code)
if len(new_code) < len(original_code):
    clipboard.copy(new_code)
    print("New code has been copied to your clipboard")
